(function(b){b.fn.closeDOMWindow=function(e){e||(e={});var c=function(){if(e.anchoredClassName){var a=b("."+e.anchoredClassName);a.fadeOut("fast",function(){b.fn.draggable?a.draggable("destory").trigger("unload").remove():a.trigger("unload").remove()})}else{var c=b("#DOMWindowOverlay"),h=b("#DOMWindow");c.fadeOut("fast",function(){c.trigger("unload").unbind().remove()});h.fadeOut("fast",function(){b.fn.draggable?h.draggable("destroy").trigger("unload").remove():h.trigger("unload").remove()});b(window).unbind("scroll.DOMWindow");
b(window).unbind("resize.DOMWindow");b.fn.openDOMWindow.isIE6&&b("#DOMWindowIE6FixIframe").remove()}e.functionCallOnClose&&e.functionCallAfterClose()};if(e.eventType)return this.each(function(){b(this).bind(e.eventType,function(){c(this);return!1})});c()};b.closeDOMWindow=function(e){b.fn.closeDOMWindow(e)};b.fn.openDOMWindow=function(e){var c=b.fn.openDOMWindow;c.defaultsSettings={anchoredClassName:"",anchoredSelector:"",borderColor:"#ccc",borderSize:"4",draggable:0,eventType:null,fixedWindowY:100,
functionCallOnOpen:null,functionCallOnClose:null,height:500,loader:0,loaderHeight:0,loaderImagePath:"",loaderWidth:0,modal:0,overlay:1,overlayColor:"#000",overlayOpacity:"85",positionLeft:0,positionTop:0,positionType:"centered",width:500,windowBGColor:"#fff",windowBGImage:null,windowHTTPType:"get",windowPadding:10,windowSource:"inline",windowSourceID:"",windowSourceURL:"",windowSourceAttrURL:"href"};var a=b.extend({},b.fn.openDOMWindow.defaultsSettings,e||{});c.viewPortHeight=function(){return self.innerHeight||
document.documentElement.clientHeight||document.body.clientHeight};c.viewPortWidth=function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth};c.scrollOffsetHeight=function(){return self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop};c.scrollOffsetWidth=function(){return self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft};c.isIE6="undefined"===typeof document.body.style.maxHeight;var j=function(){var a=
b("#DOMWindowOverlay");c.isIE6?a.css({height:document.documentElement.offsetHeight+document.documentElement.scrollTop-4+"px",width:document.documentElement.offsetWidth-21+"px"}):a.css({height:"100%",width:"100%",position:"fixed"})},h=function(){var a=document.documentElement.offsetHeight+document.documentElement.scrollTop-4,c=document.documentElement.offsetWidth-21;b("#DOMWindowIE6FixIframe").css({height:a+"px",width:c+"px"})},k=function(){var d=b("#DOMWindow");a.height+50>c.viewPortHeight()?d.css("left",
Math.round(c.viewPortWidth()/2)+c.scrollOffsetWidth()-Math.round(d.outerWidth()/2)):(d.css("left",Math.round(c.viewPortWidth()/2)+c.scrollOffsetWidth()-Math.round(d.outerWidth()/2)),d.css("top",Math.round(c.viewPortHeight()/2)+c.scrollOffsetHeight()-Math.round(d.outerHeight()/2)))},l=function(){var d=b("#DOMWindow");d.css("left",a.positionLeft+c.scrollOffsetWidth());d.css("top",+a.positionTop+c.scrollOffsetHeight())},g=function(d){d?(b("."+d+" #DOMWindowLoader").remove(),b("."+d+" #DOMWindowContent").fadeIn("fast",
function(){a.functionCallOnOpen&&a.functionCallOnOpen()}),b("."+d+".closeDOMWindow").click(function(){b.closeDOMWindow();return!1})):(b("#DOMWindowLoader").remove(),b("#DOMWindow").fadeIn("fast",function(){a.functionCallOnOpen&&a.functionCallOnOpen()}),b("#DOMWindow .closeDOMWindow").click(function(){b.closeDOMWindow();return!1}))},m=function(a){var b={};a.replace(/b([^&=]*)=([^&=]*)b/g,function(a,c,d){b[c]="undefined"!=typeof b[c]?b[c]+(","+d):d});return b},n=function(d){a.windowSourceID=b(d).attr("href")||
a.windowSourceID;a.windowSourceURL=b(d).attr(a.windowSourceAttrURL)||a.windowSourceURL;a.windowBGImage=a.windowBGImage?"background-image:url("+a.windowBGImage+")":"";var f;if("anchored"==a.positionType)switch(f=b(a.anchoredSelector).position(),d=f.left+a.positionLeft,f=f.top+a.positionTop,b("body").append('<div class="'+a.anchoredClassName+'" style="'+a.windowBGImage+";background-repeat:no-repeat;padding:"+a.windowPadding+"px;overflow:auto;position:absolute;top:"+f+"px;left:"+d+"px;height:"+a.height+
"px;width:"+a.width+"px;background-color:"+a.windowBGColor+";border:"+a.borderSize+"px solid "+a.borderColor+';z-index:10001"><div id="DOMWindowContent" style="display:none"></div></div>'),a.loader&&""!==a.loaderImagePath&&b("."+a.anchoredClassName).append('<div id="DOMWindowLoader" style="width:'+a.loaderWidth+"px;height:"+a.loaderHeight+'px;"><img src="'+a.loaderImagePath+'" /></div>'),b.fn.draggable&&a.draggable&&b("."+a.anchoredClassName).draggable({cursor:"move"}),a.windowSource){case "inline":b("."+
a.anchoredClassName+" #DOMWindowContent").append(b(a.windowSourceID).children());b("."+a.anchoredClassName).unload(function(){b("."+a.windowSourceID).append(b("."+a.anchoredClassName+" #DOMWindowContent").children())});g(a.anchoredClassName);break;case "iframe":b("."+a.anchoredClassName+" #DOMWindowContent").append('<iframe frameborder="0" hspace="0" wspace="0" src="'+a.windowSourceURL+'" name="DOMWindowIframe'+Math.round(1E3*Math.random())+'" style="width:100%;height:100%;border:none;background-color:#fff;" class="'+
a.anchoredClassName+'Iframe" ></iframe>');b("."+a.anchoredClassName+"Iframe").load(g(a.anchoredClassName));break;case "ajax":"post"==a.windowHTTPType?(-1!==a.windowSourceURL.indexOf("?")?(d=a.windowSourceURL.substr(0,a.windowSourceURL.indexOf("?")),f=m(a.windowSourceURL)):(d=a.windowSourceURL,f={}),b("."+a.anchoredClassName+" #DOMWindowContent").load(d,f,function(){g(a.anchoredClassName)})):(-1==a.windowSourceURL.indexOf("?")&&(a.windowSourceURL+="?"),b("."+a.anchoredClassName+" #DOMWindowContent").load(a.windowSourceURL+
"&random="+(new Date).getTime(),function(){g(a.anchoredClassName)}))}else{a.overlay&&(b("body").append('<div id="DOMWindowOverlay" style="z-index:10000;display:none;position:absolute;top:0;left:0;background-color:'+a.overlayColor+";filter:alpha(opacity="+a.overlayOpacity+");-moz-opacity: 0."+a.overlayOpacity+";opacity: 0."+a.overlayOpacity+';"></div>'),c.isIE6&&(b("body").append('<iframe id="DOMWindowIE6FixIframe"  src="blank.html"  style="width:100%;height:100%;z-index:9999;position:absolute;top:0;left:0;filter:alpha(opacity=0);"></iframe>'),
h()),j(),d=b("#DOMWindowOverlay"),d.fadeIn("fast"),a.modal||d.click(function(){b.closeDOMWindow()}));a.loader&&""!==a.loaderImagePath&&(b("body").append('<div id="DOMWindowLoader" style="z-index:10002;width:'+a.loaderWidth+"px;height:"+a.loaderHeight+'px;"><img src="'+a.loaderImagePath+'" /></div>'),d=b("#DOMWindowLoader"),c.isIE6?(d.css({left:Math.round(c.viewPortWidth()/2)+c.scrollOffsetWidth()-Math.round(d.innerWidth()/2),position:"absolute"}),d.css({top:Math.round(c.viewPortHeight()/2)+c.scrollOffsetHeight()-
Math.round(d.innerHeight()/2),position:"absolute"})):d.css({left:"50%",top:"50%",position:"fixed"}));b("body").append('<div id="DOMWindow" style="background-repeat:no-repeat;'+a.windowBGImage+";overflow:auto;padding:"+a.windowPadding+"px;display:none;height:"+a.height+"px;width:"+a.width+"px;background-color:"+a.windowBGColor+";border:"+a.borderSize+"px solid "+a.borderColor+'; position:absolute;z-index:10001"></div>');var e=b("#DOMWindow");switch(a.positionType){case "centered":k();a.height+50>c.viewPortHeight()&&
e.css("top",a.fixedWindowY+c.scrollOffsetHeight()+"px");break;case "absolute":e.css({top:a.positionTop+c.scrollOffsetHeight()+"px",left:a.positionLeft+c.scrollOffsetWidth()+"px"});b.fn.draggable&&a.draggable&&e.draggable({cursor:"move"});break;case "fixed":l();break;case "anchoredSingleWindow":f=b(a.anchoredSelector).position(),d=f.left+a.positionLeft,f=f.top+a.positionTop,e.css({top:f+"px",left:d+"px"})}b(window).bind("scroll.DOMWindow",function(){a.overlay&&j();c.isIE6&&h();"centered"==a.positionType&&
k();"fixed"==a.positionType&&l()});b(window).bind("resize.DOMWindow",function(){c.isIE6&&h();a.overlay&&j();"centered"==a.positionType&&k()});switch(a.windowSource){case "inline":e.append(b(a.windowSourceID).children());e.unload(function(){b(a.windowSourceID).append(e.children())});g();break;case "iframe":e.append('<iframe frameborder="0" hspace="0" wspace="0" src="'+a.windowSourceURL+'" name="DOMWindowIframe'+Math.round(1E3*Math.random())+'" style="width:100%;height:100%;border:none;background-color:#fff;" id="DOMWindowIframe" ></iframe>');
b("#DOMWindowIframe").load(g());break;case "ajax":"post"==a.windowHTTPType?(-1!==a.windowSourceURL.indexOf("?")?(d=a.windowSourceURL.substr(0,a.windowSourceURL.indexOf("?")),f=m(a.windowSourceURL)):(d=a.windowSourceURL,f={}),e.load(d,f,function(){g()})):(-1==a.windowSourceURL.indexOf("?")&&(a.windowSourceURL+="?"),e.load(a.windowSourceURL+"&random="+(new Date).getTime(),function(){g()}))}}};if(a.eventType)return this.each(function(){b(this).bind(a.eventType,function(){n(this);return!1})});n()};b.openDOMWindow=
function(e){b.fn.openDOMWindow(e)}})(jQuery);